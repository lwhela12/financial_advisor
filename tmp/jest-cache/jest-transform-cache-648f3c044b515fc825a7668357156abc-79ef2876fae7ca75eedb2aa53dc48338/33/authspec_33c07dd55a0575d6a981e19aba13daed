c169b08e36375b5f46003e1393cd64bc
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const server_js_1 = require("../src/server.js");
describe('auth routes', () => {
    let server;
    beforeAll(async () => {
        server = await (0, server_js_1.buildServer)();
    });
    afterAll(async () => {
        await server.close();
    });
    it('POST /api/v1/auth/signup returns token and sets cookie', async () => {
        const res = await server.inject({
            method: 'POST',
            url: '/api/v1/auth/signup',
            payload: { email: 'test@example.com', password: 'password123' },
        });
        expect(res.statusCode).toBe(200);
        const body = res.json();
        expect(body).toHaveProperty('token');
        const setCookie = res.headers['set-cookie'];
        // Should have a Set-Cookie header for the refresh token
        expect(setCookie).toBeDefined();
        if (Array.isArray(setCookie)) {
            expect(setCookie[0]).toMatch(/^refresh=/);
        }
        else {
            expect(setCookie).toMatch(/^refresh=/);
        }
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL2x1Y2Fzd2hlbGFuL2ZpbmFuY2lhbF9hZHZpc29yL3Rlc3RzL2F1dGguc3BlYy50cyIsIm1hcHBpbmdzIjoiOztBQUFBLGdEQUErQztBQUcvQyxRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtJQUMzQixJQUFJLE1BQXVCLENBQUM7SUFDNUIsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLE1BQU0sR0FBRyxNQUFNLElBQUEsdUJBQVcsR0FBRSxDQUFDO0lBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ0gsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2xCLE1BQU0sTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ3RFLE1BQU0sR0FBRyxHQUFHLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUM5QixNQUFNLEVBQUUsTUFBTTtZQUNkLEdBQUcsRUFBRSxxQkFBcUI7WUFDMUIsT0FBTyxFQUFFLEVBQUUsS0FBSyxFQUFFLGtCQUFrQixFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUU7U0FDaEUsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakMsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3hCLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDckMsTUFBTSxTQUFTLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM1Qyx3REFBd0Q7UUFDeEQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ2hDLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDNUMsQ0FBQzthQUFNLENBQUM7WUFDTixNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9sdWNhc3doZWxhbi9maW5hbmNpYWxfYWR2aXNvci90ZXN0cy9hdXRoLnNwZWMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYnVpbGRTZXJ2ZXIgfSBmcm9tICcuLi9zcmMvc2VydmVyLmpzJztcbmltcG9ydCB0eXBlIHsgRmFzdGlmeUluc3RhbmNlIH0gZnJvbSAnZmFzdGlmeSc7XG5cbmRlc2NyaWJlKCdhdXRoIHJvdXRlcycsICgpID0+IHtcbiAgbGV0IHNlcnZlcjogRmFzdGlmeUluc3RhbmNlO1xuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIHNlcnZlciA9IGF3YWl0IGJ1aWxkU2VydmVyKCk7XG4gIH0pO1xuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgc2VydmVyLmNsb3NlKCk7XG4gIH0pO1xuXG4gIGl0KCdQT1NUIC9hcGkvdjEvYXV0aC9zaWdudXAgcmV0dXJucyB0b2tlbiBhbmQgc2V0cyBjb29raWUnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgc2VydmVyLmluamVjdCh7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIHVybDogJy9hcGkvdjEvYXV0aC9zaWdudXAnLFxuICAgICAgcGF5bG9hZDogeyBlbWFpbDogJ3Rlc3RAZXhhbXBsZS5jb20nLCBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJyB9LFxuICAgIH0pO1xuICAgIGV4cGVjdChyZXMuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgIGNvbnN0IGJvZHkgPSByZXMuanNvbigpO1xuICAgIGV4cGVjdChib2R5KS50b0hhdmVQcm9wZXJ0eSgndG9rZW4nKTtcbiAgICBjb25zdCBzZXRDb29raWUgPSByZXMuaGVhZGVyc1snc2V0LWNvb2tpZSddO1xuICAgIC8vIFNob3VsZCBoYXZlIGEgU2V0LUNvb2tpZSBoZWFkZXIgZm9yIHRoZSByZWZyZXNoIHRva2VuXG4gICAgZXhwZWN0KHNldENvb2tpZSkudG9CZURlZmluZWQoKTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShzZXRDb29raWUpKSB7XG4gICAgICBleHBlY3Qoc2V0Q29va2llWzBdKS50b01hdGNoKC9ecmVmcmVzaD0vKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXhwZWN0KHNldENvb2tpZSkudG9NYXRjaCgvXnJlZnJlc2g9Lyk7XG4gICAgfVxuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==