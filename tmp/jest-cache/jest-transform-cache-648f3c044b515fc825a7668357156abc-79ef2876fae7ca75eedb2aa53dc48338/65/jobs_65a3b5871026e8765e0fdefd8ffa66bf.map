{"file":"/Users/lucaswhelan/financial_advisor/src/api/jobs.ts","mappings":";;AAIA,6BA4CC;AA9CD,mDAAgD;AAEjC,KAAK,UAAU,UAAU,CAAC,MAAuB;IAC9D,MAAM,CAAC,GAAG,CAAC,kBAAkB,EAAE;QAC7B,UAAU,EAAE,CAAC,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE;gBACpC,IAAI,CAAC;oBACH,MAAM,OAAO,CAAC,SAAS,EAAE,CAAC;gBAC5B,CAAC;gBAAC,OAAO,GAAG,EAAE,CAAC;oBACb,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,cAAc,EAAE,CAAC,CAAC;gBACpD,CAAC;YACH,CAAC,CAAC;QACF,MAAM,EAAE;YACN,MAAM,EAAE;gBACN,IAAI,EAAE,QAAQ;gBACd,UAAU,EAAE;oBACV,EAAE,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;iBACvB;gBACD,QAAQ,EAAE,CAAC,IAAI,CAAC;aACjB;YACD,QAAQ,EAAE;gBACR,GAAG,EAAE;oBACH,IAAI,EAAE,QAAQ;oBACd,UAAU,EAAE;wBACV,MAAM,EAAE;4BACN,IAAI,EAAE,QAAQ;4BACd,IAAI,EAAE,CAAC,SAAS,EAAE,YAAY,EAAE,WAAW,EAAE,QAAQ,CAAC;yBACvD;wBACD,KAAK,EAAE,EAAE,IAAI,EAAE,QAAQ,EAAE;qBAC1B;oBACD,QAAQ,EAAE,CAAC,QAAQ,CAAC;iBACrB;aACF;YACD,QAAQ,EAAE,EAAE;SACb;KACF,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,EAAE;QAC1B,MAAM,EAAE,EAAE,EAAE,GAAG,OAAO,CAAC,MAAwB,CAAC;QAEhD,MAAM,GAAG,GAAG,MAAM,mBAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QACtC,IAAI,CAAC,GAAG,EAAE,CAAC;YACT,OAAO,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,eAAe,EAAE,CAAC,CAAC;QAC5D,CAAC;QAED,MAAM,KAAK,GAAG,MAAM,GAAG,CAAC,QAAQ,EAAE,CAAC;QAEnC,OAAO,KAAK,CAAC,IAAI,CAAC,EAAE,MAAM,EAAE,KAAY,EAAE,KAAK,EAAE,GAAG,CAAC,YAAY,IAAI,SAAS,EAAE,CAAC,CAAC;IACpF,CAAC,CAAC,CAAC;AACL,CAAC","names":[],"sources":["/Users/lucaswhelan/financial_advisor/src/api/jobs.ts"],"sourcesContent":["import type { FastifyInstance } from 'fastify';\n\nimport { ocrQueue } from '../services/queue.js';\n\nexport default async function jobsRoutes(server: FastifyInstance) {\n  server.get('/api/v1/jobs/:id', {\n    preHandler: [async (request, reply) => {\n      try {\n        await request.jwtVerify();\n      } catch (err) {\n        reply.code(401).send({ message: 'Unauthorized' });\n      }\n    }],\n    schema: {\n      params: {\n        type: 'object',\n        properties: {\n          id: { type: 'string' },\n        },\n        required: ['id'],\n      },\n      response: {\n        200: {\n          type: 'object',\n          properties: {\n            status: {\n              type: 'string',\n              enum: ['pending', 'processing', 'succeeded', 'failed'],\n            },\n            error: { type: 'string' },\n          },\n          required: ['status'],\n        },\n      },\n      required: [],\n    },\n  }, async (request, reply) => {\n    const { id } = request.params as { id: string };\n\n    const job = await ocrQueue.getJob(id);\n    if (!job) {\n      return reply.code(404).send({ message: 'Job not found' });\n    }\n\n    const state = await job.getState();\n\n    return reply.send({ status: state as any, error: job.failedReason ?? undefined });\n  });\n}\n"],"version":3}